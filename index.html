<!DOCTYPE html>
<html>
<head>
<title>Myanmar Energy Accesibiility</title>
<link rel="stylesheet" href="style.css" type="text/css" media="screen" />
<style type='text/css'>
.background {
    fill: #eee;
    pointer-events: all;
}

.map-layer {
    fill: #fff;
    stroke: #aaa;
}

text{
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 300;
}

text.big-text {
    font-size: 30px;
    font-weight: 400;
}
</style>
</head>
<body>
<div id="main-wrapper">
    <!-- <button id="zoom_in">+</button>
    <button id="zoom_out">-</button> -->
<svg></svg>

<div id="tooltip" class="tooltip">
    <h3 class="name"></h3>
    <div data-metric="HC01_EST_VC04" class="line">
        <div class="HC01_EST_VC04 symbol"></div> Drive Alone
        <div class="HC01_EST_VC04_val moe"></div>
        <div class="HC01_EST_VC04_val val"></div>
    </div>
    <div data-metric="HC01_EST_VC05" class="line">
        <div class="HC01_EST_VC05 symbol"></div> Carpool
        <div class="HC01_EST_VC05_val moe"></div>
        <div class="HC01_EST_VC05_val val"></div>
    </div>
    <div data-metric="HC01_EST_VC10" class="line">
        <div class="HC01_EST_VC10 symbol"></div> Public Trans.
        <div class="HC01_EST_VC10_val moe"></div>
        <div class="HC01_EST_VC10_val val"></div>
    </div>
    <div data-metric="HC01_EST_VC11" class="line">
        <div class="HC01_EST_VC11 symbol"></div> Walk
        <div class="HC01_EST_VC11_val moe"></div>
        <div class="HC01_EST_VC11_val val"></div>
    </div>
    <div data-metric="HC01_EST_VC12" class="line">
        <div class="HC01_EST_VC12 symbol"></div> Bicycle
        <div class="HC01_EST_VC12_val moe"></div>
        <div class="HC01_EST_VC12_val val"></div>
    </div>
    <div data-metric="HC01_EST_VC13" class="line">
        <div class="HC01_EST_VC13 symbol"></div> Taxi or Other
        <div class="HC01_EST_VC13_val moe"></div>
        <div class="HC01_EST_VC13_val val"></div>
    </div>
    <div data-metric="HC01_EST_VC14" class="line">
        <div class="HC01_EST_VC14 symbol"></div> Work from Home
        <div class="HC01_EST_VC14_val moe"></div>
        <div class="HC01_EST_VC14_val val"></div>
    </div>
</div>

</div><!-- @end #main-wrapper -->

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

var width = 1200,
    height = 1200,
    centered;

var color = d3.scale.linear()
    .domain([1, 100])
    .clamp(true)
    .range(['#fff', '#409A99']);

var projection = d3.geo.mercator()
    .scale(3000)
    .center([96.7, 19.1])
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var zoom = d3.behavior.zoom()
    .scaleExtent([1, 20])
    .on('zoom', zoomed);

var svg = d3.select('svg')
    .attr('width', width)
    .attr('height', height);

var g = svg.append('g');

// svg.on('wheel.zoom', null);
// svg.on('mousewheel.zoom', null);

svg.call(zoom)
    .call(zoom.event);

var mapLayer = g.append('g')
    .classed('map-layer', true);

var bigText = g.append('text')
    .classed('big-text', true)
    .attr('x', 100)
    .attr('y', 100);

function zoomed() {
    g.attr("transform",
        "translate(" + zoom.translate() + ")" + "scale(" + zoom.scale() + ")"
    );
};

d3.json('data/ts_1.geojson', function(error, mapData) {
    var features = mapData.features;

    color.domain([0, d3.max(features, popFn)]);

    mapLayer.selectAll('path')
        .data(features)
        .enter().append('path')
        .attr('d', path)
        .attr('vector-effect', 'non-scaling-stroke')
        .style('fill', fillFn)
        .on('mouseover', mouseover)
        .on('mouseout', mouseout);
});

function mouseover(d) {
    d3.select(this).style('fill', 'orange');
    textArt(nameFn(d));
};

function mouseout(d) {
    mapLayer.selectAll('path')
        .style('fill', function(d) {
            return centered && d === centered ? '#D5708B' : fillFn(d);
        })
    bigText.text('');
};

function textArt(text) {
    bigText.text(text);
};

function nameFn(d) {
    return d && d.properties ? d.properties.TS : null;
};

function nameLength(d) {
    var n = nameFn(d);
    return n ? n.length : 0;
};

function popFn(d) {
    return d && d.properties ? d.properties.Total : 0;
};

function fillFn(d) {
    return color(popFn(d));
};

/*
// Zoom buttons
svg.selectAll(".button")
    .data(['zoom_in', 'zoom_out'])
    .enter()
    .append("g")
    .attr("id", function(d){return d})
    .attr("class", "button")
    .attr({x: 20, width: 20, height: 20})
    .append("rect")
    .attr("y", function(d,i) { return 20 + 25*i })
    .attr({x: 20, width: 20, height: 20});

// Plus button
svg.select("#zoom_in")
    .append("line")
    .attr({x1: 25, y1: 30, x2: 35, y2: 30 })
    .attr("stroke", "#fff")
    .attr("stroke-width", "2px");

svg.select("#zoom_in")
    .append("line")
    .attr({x1: 30, y1: 25, x2: 30, y2: 35 })
    .attr("stroke", "#fff")
    .attr("stroke-width", "2px");

// Minus button
svg.select("#zoom_out")
    .append("line")
    .attr({x1: 25, y1: 55, x2: 35, y2: 55 })
    .attr("stroke", "#fff")
    .attr("stroke-width", "2px");

svg.selectAll(".button")
    .on("click", zoomClick);

svg.select("#progress-image").remove();
*/

function zoomClick() {
    var clicked = d3.event.target,
        direction = 1,
        factor = 0.2,
        target_zoom = 1,
        center = [width / 2, height / 2],
        extent = zoom.scaleExtent(),
        translate = zoom.translate(),
        translate0 = [],
        l = [],
        view = {x: translate[0], y: translate[1], k: zoom.scale()};

    d3.event.preventDefault();
    direction = (this.id === 'zoom_in') ? 1 : -1;
    target_zoom = zoom.scale() * (1 + factor * direction);

    if (target_zoom < extent[0] || target_zoom > extent[1]) { return false; }

    translate0 = [(center[0] - view.x) / view.k, (center[1] - view.y) / view.k];
    view.k = target_zoom;
    l = [translate0[0] * view.k + view.x, translate0[1] * view.k + view.y];

    view.x += center[0] - l[0];
    view.y += center[1] - l[1];

    interpolateZoom([view.x, view.y], view.k);
};

function interpolateZoom (translate, scale) {
    var self = this;
    return
        d3.transition()
            .duration(350)
            .tween("zoom", function () {
                var iTranslate = d3.interpolate(zoom.translate(), translate),
                    iScale = d3.interpolate(zoom.scale(), scale);

                return function (t) {
                    zoom.scale(iScale(t))
                        .translate(iTranslate(t));
                    zoomed();
                };
            });
};

// d3.selectAll('button').on('click', zoomClick);

</script>
</body>
</html>
